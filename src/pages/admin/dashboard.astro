---
import AdminLayout from "@layouts/AdminLayout.astro"
import { Stats } from "@components/admin/Stats"
import { supabase } from "@lib/supabase"
import { getSubscriptions } from "@components/supabase/GetSubscriptions"

// Obtener estadísticas
const { data: usersCount } = await supabase.from("users_profiles").select("id", { count: "exact" })
const subscriptions = await getSubscriptions()

const stats = {
	totalUsers: usersCount?.length || 0,
	newUsers: 0, // TODO: Implementar cálculo de usuarios nuevos
	activeSubscriptions: subscriptions?.length || 0,
	renewalRate: 0, // TODO: Implementar cálculo de tasa de renovación
	monthlyRevenue: 0, // TODO: Implementar cálculo de ingresos
	revenueChange: 0, // TODO: Implementar cálculo de cambio en ingresos
	popularPlan: "2 Dispositivos",
	popularPlanPercentage: 0, // TODO: Implementar cálculo de porcentaje
}
---

<AdminLayout title="Admin Dashboard - ZeroPlay">
	<div class="glass rounded-2xl p-8">
		<div class="mb-8 flex items-center justify-between">
			<div>
				<h1 class="text-3xl font-bold text-white">Panel de Administración</h1>
				<p class="mt-2 text-white/80">Gestiona usuarios y suscripciones</p>
			</div>
		</div>

		<!-- Estadísticas -->
		<Stats client:load stats={stats} />

		<!-- Acciones Rápidas -->
		<div class="mb-8 mt-8">
			<h2 class="mb-4 text-xl font-semibold text-white">Acciones Rápidas</h2>
			<div class="flex space-x-4">
				<a
					href="/admin/users"
					class="rounded-lg bg-primary-500 px-4 py-2 font-semibold text-white transition-colors hover:bg-primary-600"
				>
					Gestionar Usuarios
				</a>
				<a
					href="/admin/subscriptions"
					class="rounded-lg bg-secondary-500 px-4 py-2 font-semibold text-white transition-colors hover:bg-secondary-600"
				>
					Gestionar Suscripciones
				</a>
			</div>
		</div>

		<!-- Actividad Reciente -->
		<div>
			<h2 class="mb-4 text-xl font-semibold text-white">Actividad Reciente</h2>
			<div class="glass rounded-xl p-6">
				<p class="text-white/80">No hay actividad reciente para mostrar.</p>
			</div>
		</div>
	</div>
</AdminLayout>
